<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bus Ticket Generator</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body {
  background: #eee;
  font-family: Arial, sans-serif;
  padding: 20px;
}

/* FORM */
.form-section {
  max-width: 750px;
  margin: auto;
  background: #fff;
  padding: 25px;
  border-radius: 8px;
}

.form-section h2 {
  text-align: center;
}

label {
  font-weight: bold;
  margin-top: 10px;
  display: block;
}

input, select {
  width: 100%;
  padding: 8px;
  margin-top: 5px;
}

button {
  padding: 8px 12px;
  margin-top: 10px;
  cursor: pointer;
}

/* PASSENGERS */
.passenger {
  border: 1px dashed #ccc;
  padding: 10px;
  margin-top: 10px;
}

/* TICKET */
.ticket-wrapper {
  display: flex;
  justify-content: center;
  margin-top: 30px;
}

.ticket {
  width: 380px;
  padding: 15px;
  background: #fff;
  border: 2px dashed #000;
  font-family: "Courier New", monospace;
}

.ticket h2 {
  text-align: center;
  font-size: 18px;
  margin-bottom: 5px;
}

.ticket p {
  font-size: 13px;
  margin: 3px 0;
}

.ticket table {
  width: 100%;
  border-collapse: collapse;
}

.ticket th, .ticket td {
  font-size: 13px;
  border-bottom: 1px dashed #000;
  padding: 4px;
}

.ticket th:last-child,
.ticket td:last-child {
  text-align: right;
}

.ticket small {
  display: block;
  text-align: center;
  margin-top: 6px;
  font-size: 11px;
}
</style>
</head>

<body>

<div class="form-section">
<h2>Bus Ticket Form</h2>

<label>Company Name</label>
<select id="companyName">
  <option value="NueGo">NueGo</option>
          <option value="Vikas Travels Jaipur">Vikas Travels Jaipur</option>
          <option value="Vijay Shakti Travels">Vijay Shakti Travels</option>
          <option value="Gajraj Travels">Gajraj Travels</option>
          <option value="Rishabh travels">Rishabh travels</option>
          <option value="Mahadev Travels">Mahadev Travels</option>
          <option value="Maharani Travels">Maharani Travels</option>
          <option value="Goldline Super Deluxe">Goldline Super Deluxe</option>
          <option value="Rahi Travells">Rahi Travells</option>
          <option value="Ashok Travels Mandsaur">Ashok Travels Mandsaur</option>
</select>

<label>From</label>
<input id="fromCity">

<label>To</label>
<input id="toCity">

<label>Date</label>
<input type="date" id="invoiceDate">

<label>Payment Mode</label>
<select id="paymentMode">
  <option>CASH</option>
  <option>UPI</option>
</select>

<h3>Passengers</h3>
<div id="passengers"></div>

<button onclick="addPassenger()">+ Add Passenger</button>
<br><br>
<button onclick="generateTicket()">Generate Ticket</button>
<button onclick="downloadPDF()">Download PDF</button>
</div>

<div class="ticket-wrapper">
<div id="ticket" class="ticket"></div>
</div>

<script>
let srCounter = 1;

function addPassenger() {
  const div = document.createElement("div");
  div.className = "passenger";
  div.innerHTML = `
    <label>Name</label>
    <input class="pname">
    <label>Seat</label>
    <input class="pseat">
    <label>Fare</label>
    <input type="number" class="pfare">
    <button onclick="this.parentElement.remove()">Remove</button>
  `;
  document.getElementById("passengers").appendChild(div);
}

function numberToWords(num) {
  const a=['','One','Two','Three','Four','Five','Six','Seven','Eight','Nine','Ten','Eleven','Twelve','Thirteen','Fourteen','Fifteen','Sixteen','Seventeen','Eighteen','Nineteen'];
  const b=['','','Twenty','Thirty','Forty','Fifty','Sixty','Seventy','Eighty','Ninety'];
  if(num===0) return 'Zero';
  function c(n){
    let s='';
    if(n>=100000){s+=c(Math.floor(n/100000))+' Lakh ';n%=100000;}
    if(n>=1000){s+=c(Math.floor(n/1000))+' Thousand ';n%=1000;}
    if(n>=100){s+=c(Math.floor(n/100))+' Hundred ';n%=100;}
    if(n>0){
      if(s!=='') s+='and ';
      if(n<20) s+=a[n];
      else s+=b[Math.floor(n/10)] + (n%10?' '+a[n%10]:'');
    }
    return s.trim();
  }
  return c(num);
}

function generateTicket() {
  const passengers = document.querySelectorAll(".passenger");
  let total = 0;
  let rows = "";

  passengers.forEach((p,i)=>{
    const name = p.querySelector(".pname").value;
    const seat = p.querySelector(".pseat").value;
    const fare = parseFloat(p.querySelector(".pfare").value||0);
    total += fare;
    rows += `<tr><td>${name} (${seat})</td><td>${fare.toFixed(2)}</td></tr>`;
  });

  const srNo = `${new Date().getFullYear()}-${srCounter++}`;

  document.getElementById("ticket").innerHTML = `
    <h2>${companyName.value}</h2>
    <p>SR No: ${srNo}</p>
    <p>Route: ${fromCity.value} â†’ ${toCity.value}</p>
    <p>Date: ${invoiceDate.value}</p>
    <p>Payment: ${paymentMode.value}</p>
    <hr>
    <table>
      <tr><th>Passenger</th><th>Fare</th></tr>
      ${rows}
      <tr><td><strong>Total</strong></td><td>${total.toFixed(2)}</td></tr>
    </table>
    <p><strong>Rupees ${numberToWords(Math.floor(total))} Only</strong></p>
    <small>Thank you & have a safe journey</small>
  `;
}

async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p", "mm", "a4");

  const ticket = document.getElementById("ticket");

  const canvas = await html2canvas(ticket, {
    scale: 4,          // ðŸ‘ˆ high clarity
    useCORS: true
  });

  const imgData = canvas.toDataURL("image/png");

  const pageWidth = 210;      // A4 width (mm)
  const pageHeight = 297;     // A4 height (mm)

  const margin = 15;
  const usableWidth = pageWidth - margin * 2;

  const imgWidth = usableWidth;
  const imgHeight = (canvas.height * imgWidth) / canvas.width;

  let y = margin;

  // Agar height A4 se zyada ho to auto scale
  if (imgHeight > pageHeight - margin * 2) {
    const scale = (pageHeight - margin * 2) / imgHeight;
    pdf.addImage(
      imgData,
      "PNG",
      margin,
      margin,
      imgWidth * scale,
      imgHeight * scale
    );
  } else {
    pdf.addImage(
      imgData,
      "PNG",
      margin,
      y,
      imgWidth,
      imgHeight
    );
  }

  const firstPassenger =
    document.querySelector(".pname")?.value || "Ticket";
  const date = invoiceDate.value || "date";

  pdf.save(`${firstPassenger}_${date}.pdf`);
}
</script>

</body>
</html>

